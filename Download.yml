---
- hosts: windows
  vars:
    myAnalogSitePath: "E:\\inetpub\\My"
    staging_path: "E:\\download"    
    env: "DEV"
    ReleaseVersion: "19.1.1.0.85"
    envFolder: "env-specific"
    bkpPath: "E:\\Backup"
  tasks:
  - name: Downloading latest release to staging folder
    win_copy:
      src: //NWD2ALGWCMDEV1/Inetpub/sitecore/Website/Views/web.config
      dest: E:\Download\web.config
      remote_src: yes
  - name: Unzip latest release file in staging folder
    win_unzip:
      src: "{{ staging_path }}\\{{ ReleaseVersion }}.zip"
      dest: "{{ staging_path }}\\"      
    tags: unzip
  - name: Take Backup of website folder
    win_copy:
      src: "{{ myAnalogSitePath }}\\"
      dest: "{{ bkpPath }}\\"
      remote_src: yes
  - name: Copying Environment Specific files to website folder
    win_copy:
      src: "{{ staging_path }}\\{{ ReleaseVersion }}\\{{envFolder}}\\{{env}}"
      dest: "{{ myAnalogSitePath }}\\"
      remote_src: yes
  - name: Clean up Environment Specific
    win_file:
      path: "{{ staging_path }}\\{{ ReleaseVersion }}\\{{envFolder}}"
      state: absent
  - name: Copying Deployment files to website folder
    win_copy:
      src: "{{ staging_path }}\\{{ ReleaseVersion }}\\"
      dest: "{{ myAnalogSitePath }}\\"
      remote_src: yes
